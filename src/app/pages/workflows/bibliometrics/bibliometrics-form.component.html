<div id="modal-input" class="uk-modal-full modal-secondary" uk-modal='{"esc-close": false, "bg-close": false}'>

  <div class="uk-modal-dialog" style="min-height: 100svh">
    <button class="uk-modal-close-full uk-close-large" type="button" (click)="navigateBack()" uk-close></button>

    <div id="modal-header" class="uk-modal-header uk-flex uk-flex-middle uk-visible@m">
      <img src="assets/images/logos/opix%20logo%202_notag.png" alt="Opix Platform" class="uk-margin-medium-right" width="150px" height="60px">
      <h4 class="uk-modal-title uk-margin-remove">Bibliometrics</h4>
    </div>

    <div id="modal-header-mobile" class="uk-modal-header uk-hidden@m uk-text-center">
      <img src="assets/images/logos/opix%20logo%202_notag.png" alt="Opix Platform" class="" width="150px" height="60px">
      <h4 class="uk-modal-title uk-margin-remove">Bibliometrics</h4>
    </div>

    <div class="">

      <div *ngIf="!submitSuccess" class="uk-container uk-container-expand">

        <div class="" uk-grid>
          <div class="uk-width-1-3 uk-section-default uk-visible@m" [ngStyle]="{'min-height': 'calc(100vh - ' + headerHeight + 'px)'}">
            <ul id="tabs" class="uk-tab uk-tab-left wizard-tabs uk-margin-large-top">
              <li class="uk-margin-bottom" [ngClass]="{'step-enabled': stepComplete(0)}">
                <a href="#" class="" (click)="tabIndex = 0">
                  <div class="step-icon uk-margin-right">
                    <span class="material-icons">{{stepComplete(0) ? 'check_circle':'circle'}}</span>
                  </div>
                  <div>
                    <div class="step-header uk-text-bold">Database</div>
                    <div class="step-description uk-text-light uk-margin-small-top">Pick the resource, most suitable for your analysis</div>
                  </div>
                </a>
              </li>
              <li class="uk-margin-bottom" [ngClass]="{'step-enabled': stepComplete(0), 'uk-disabled': !stepComplete(0)}">
                <a href="#" class="" (click)="tabIndex = 1">
                  <div class="step-icon uk-margin-right">
                    <span class="material-icons">{{stepComplete(1) ? 'check_circle':'circle'}}</span>
                  </div>
                  <div>
                    <div class="step-header uk-text-bold">Fields of Science</div>
                    <div class="step-description uk-text-light uk-margin-small-top">Select the field(s) & Research area(s)</div>
                  </div>
                </a>
              </li>
              <li class="uk-margin-bottom" [ngClass]="{'step-enabled': stepComplete(1), 'uk-disabled': !stepComplete(1)}">
                <a href="#" class="" (click)="tabIndex = 2">
                  <div class="step-icon uk-margin-right">
                    <span class="material-icons">{{stepComplete(2) ? 'check_circle':'circle'}}</span>
                  </div>
                  <div>
                    <div class="step-header uk-text-bold">Filters</div>
                    <div class="step-description uk-text-light uk-margin-small-top">Filter by Country and Year, Access Rights, Publication Type</div>
                  </div>
                </a>
              </li>
              <li class="uk-margin-bottom" [ngClass]="{'step-enabled': stepComplete(2) && stepComplete(1), 'uk-disabled': !(stepComplete(2) && stepComplete(1))}">
                <a href="#" class="" (click)="tabIndex = 3">
                  <div class="step-icon uk-margin-right">
                    <span class="material-icons">{{stepComplete(3) ? 'check_circle':'circle'}}</span>
                  </div>
                  <div>
                    <div class="step-header uk-text-bold">Indicators</div>
                    <div class="step-description uk-text-light uk-margin-small-top">Pick the indicators to show in your dashboard</div>
                  </div>
                </a>
              </li>
              <li class="uk-margin-bottom" [ngClass]="{'step-enabled': stepComplete(3), 'uk-disabled': !stepComplete(3)}">
                <a href="#" class="" (click)="tabIndex = 4">
                  <div class="step-icon uk-margin-right">
                    <span class="material-icons">{{stepComplete(4) ? 'check_circle':'circle'}}</span>
                  </div>
                  <div>
                    <div class="step-header uk-text-bold">Summary</div>
                    <div class="step-description uk-text-light uk-margin-small-top">View a summary of your selections before you proceed</div>
                  </div>
                </a>
              </li>
            </ul>
          </div>

          <div class="uk-width-expand" style="overflow-y: scroll">
            <div class="uk-container uk-container-xsmall">

              <div class="uk-grid uk-flex uk-flex-center">
                <div class="uk-width-2-3@m uk-width-2-3@l uk-width-1-1@s">
                  <ul class="uk-switcher switcher-container uk-margin-large-top">
                    <li>
                      <div class="uk-text-center uk-margin-medium-bottom">
                        <div class="uk-text-bold uk-margin-small-bottom uk-text-large">Database</div>
                        <div class="uk-text-light">Pick the resource, most suitable for your analysis</div>
                      </div>
                      <form [formGroup]="bibliometricForm">
                        <div class="uk-margin-medium-bottom">
                          <div class="uk-margin-bottom">
                            <div class="uk-margin-small-bottom">
                              <label class="uk-text-bold uk-text-small" for="dataSource">Data Source *</label>
                            </div>
                            <ng-select labelForId="dataSource" [searchable]="false" [clearable]="false" formControlName="dataSource">
                              <ng-option [value]="'OpenAIRE Graph'">OpenAIRE Graph</ng-option>
                              <ng-option [value]="'SemanticScholar'" [disabled]="true">SemanticScholar</ng-option>
                            </ng-select>
                          </div>
                        </div>
                      </form>
                      <div class="uk-text-center uk-margin-top uk-margin-large-bottom">
                        <a class="uk-button uk-button-primary uk-width-1-1" (click)="continue(1)"
                           [ngClass]="{'uk-disabled': !stepComplete(0)}">Continue
                        </a>
                      </div>
                    </li>
                    <li>
                      <div class="uk-text-center uk-margin-medium-bottom">
                        <div class="uk-text-bold uk-margin-small-bottom uk-text-large">Fields of Science</div>
                        <div class="uk-text-light">Select the field(s) & Research area(s)</div>
                      </div>
                      <form [formGroup]="bibliometricForm">
                        <div class="uk-margin-medium-bottom">

                          <div class="uk-margin-bottom">
                            <div class="uk-margin-small-bottom">
                              <label class="uk-text-bold uk-text-small" for="domain">Subject *</label>
                            </div>
                            <ng-select #domain labelForId="domain" [items]="domains" [selectOnTab]="true"
                                       [searchable]="false" formControlName="domain">
                            </ng-select>
                          </div>

                          <div class="uk-margin-bottom">
                            <div class="uk-margin-small-bottom">
                              <label class="uk-text-bold uk-text-small" for="category" uk-tooltip="(including IPC/CPC sections)">Sector *</label>
                            </div>
                            <ng-select #category labelForId="category" [items]="categories" [selectOnTab]="true"
                                       [searchable]="false" formControlName="category">
                            </ng-select>
                          </div>

                          <div class="uk-margin-bottom">
                            <div class="uk-margin-small-bottom">
                              <label class="uk-text-bold uk-text-small"  uk-tooltip="(including IPC/CPC classes)">
                                Technological group *
                              </label>
                              <label>
                                <input #selectAll type="checkbox" class="uk-margin-left uk-margin-small-right"
                                       [disabled]="!bibliometricForm.get('topics').enabled"
                                       [checked]="allTopics" (change)="selectAllTopics($event)">
                                <span class="uk-text-muted">Select all</span>
                              </label>
                            </div>
                            <div class="checkbox-list">
                              <div class="uk-padding-small">
                                <div class="uk-flex uk-flex-top uk-margin-small-bottom" *ngFor="let topic of topics; let i=index">
                                  <input [id]="i" type="checkbox" [value]="topic['topic']" class="uk-margin-small-right"
                                         (change)="topicSelect($event); (removeCheck('topics') && selectAll.checked) ? selectAll.click() : ''"
                                         [checked]="showChecked('topics', topic['topic'])">
                                  <label [for]="i">
                                    {{(topic['code'] ? '(' + topic['code'] + ') ' : '') + topic['label']}}
                                  </label>
                                </div>
                              </div>
                            </div>
                          </div>

                        </div>
                      </form>
                      <!--                  <a href="#" uk-switcher-item="previous" class="uk-margin-small-right">Previous</a>-->
                      <div class="uk-text-center uk-margin-top uk-margin-large-bottom">
                        <a class="uk-button uk-button-primary uk-width-1-1" (click)="continue(2)"
                           [ngClass]="{'uk-disabled': !stepComplete(1)}">Continue
                        </a>
                      </div>
                    </li>
                    <li>
                      <div class="uk-text-center uk-margin-medium-bottom">
                        <div class="uk-text-bold uk-margin-small-bottom uk-text-large">Filters</div>
                        <div class="uk-text-light">Filter by Country and Year, Access Rights, Publication Type</div>
                      </div>
                      <form [formGroup]="bibliometricForm">
                        <div class="uk-margin-medium-bottom">

                          <div class="uk-grid">
                            <div class="uk-margin-bottom uk-width-1-2">
                              <div class="uk-margin-small-bottom">
                                <label class="uk-text-bold uk-text-small" for="from">Year from</label>
                              </div>
                              <ng-select #from labelForId="from" [searchable]="false" formControlName="from">
                                <ng-option *ngFor="let year of yearRange" [value]="''+year">{{year}}</ng-option>
                              </ng-select>
                            </div>

                            <div class="uk-margin-bottom uk-width-1-2">
                              <div class="uk-margin-small-bottom">
                                <label class="uk-text-bold uk-text-small" for="to">Year to</label>
                              </div>
                              <ng-select #to labelForId="to" [searchable]="false" formControlName="to">
                                <ng-option *ngFor="let year of yearRange" [value]="''+year">{{year}}</ng-option>
                              </ng-select>
                            </div>
                          </div>

                          <div class="uk-margin-bottom">
                            <div class="uk-margin-small-bottom">
                              <label class="uk-text-bold uk-text-small" for="countries">Countries of Organizations in Affiliations</label>
                              <label>
                                <input #allCountries type="checkbox" class="uk-margin-left uk-margin-small-right" (change)="selectAllCountries($event)">
                                <span class="uk-text-muted">Select all</span>
                              </label>
                            </div>
                            <ng-select #countries labelForId="countries" [groupBy]="'continent'" bindValue="country_code" bindLabel="name"
                                       [multiple]="true" [items]="countriesFlat" [selectableGroup]="true" [searchable]="true"
                                       [closeOnSelect]="false" [clearSearchOnAdd]="true" [virtualScroll]="true"
                                       [selectableGroupAsModel]="false" [compareWith]="compareAccounts" formControlName="countries"
                                       (clear)="allCountries.checked ? allCountries.click() : ''" class="auto-height"
                                       (remove)="(removeCheck('countries') && allCountries.checked) ? allCountries.click() : ''">
                              <ng-template ng-optgroup-tmp let-item="item" let-item$="item$" let-index="index">
                                <input id="item-{{index}}" type="checkbox" [checked]="item$.selected"/> {{item.continent | uppercase}}
                              </ng-template>
                              <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
                                <input id="item-{{index}}" type="checkbox" [checked]="item$.selected"/> {{item['name']}}
                              </ng-template>
                              <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
                                <div class="ng-value" *ngFor="let item of items | slice:0:5">
                                  <span class="ng-value-icon right" (click)="clear(item)" aria-hidden="true">×</span>
                                  <span class="ng-value-label">{{item['name'] ? item['name'] : item['continent']}}</span>
                                </div>
                                <div class="ng-value" *ngIf="items.length > 5">
                                  <span class="ng-value-label">{{items.length - 5}} more...</span>
                                </div>
                              </ng-template>
                            </ng-select>
                          </div>

                          <div class="uk-margin-bottom">
                            <div class="uk-margin-small-bottom">
                              <label class="uk-text-bold uk-text-small" for="accessRights">Access Rights</label>
                              <label>
                                <input #allAccessRights type="checkbox" class="uk-margin-left uk-margin-small-right" (change)="selectAllData($event, 'accessRights')">
                                <span class="uk-text-muted">Select all</span>
                              </label>
                            </div>
                            <ng-select #accessRight labelForId="accessRights" [items]="accessRights" formControlName="accessRights"
                                       [multiple]="true" (clear)="allAccessRights.checked ? allAccessRights.click() : ''"
                                       (remove)="(removeCheck('accessRights') && allAccessRights.checked)?allAccessRights.click():''">
                              <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
                                <input id="item-{{index}}" type="checkbox" [checked]="item$.selected"/> {{item}}
                              </ng-template>
                              <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
                                <div class="ng-value" *ngFor="let item of items | slice:0:2">
                                  <span class="ng-value-icon right" (click)="clear(item)" aria-hidden="true">×</span>
                                  <span class="ng-value-label">{{item}}</span>
                                </div>
                                <div class="ng-value" *ngIf="items.length > 2">
                                  <span class="ng-value-label">{{items.length - 2}} more...</span>
                                </div>
                              </ng-template>
                            </ng-select>
                          </div>

<!--                          <div class="uk-margin-bottom">-->
<!--                            <div class="uk-margin-small-bottom">-->
<!--                              <label class="uk-text-bold uk-text-small" for="additionalOptions">Additional Options</label>-->
<!--                              <label>-->
<!--                                <input #allAdditionalOptions type="checkbox" class="uk-margin-left uk-margin-small-right" (change)="selectAllData($event, 'additionalOptions')">-->
<!--                                <span class="uk-text-muted">Select all</span>-->
<!--                              </label>-->
<!--                            </div>-->
<!--                            <ng-select #additionalOption labelForId="additionalOptions" [items]="additionalOptions" formControlName="additionalOptions"-->
<!--                                       [multiple]="true" (clear)="allAdditionalOptions.checked ? allAdditionalOptions.click() : ''"-->
<!--                                       (remove)="(removeCheck('additionalOptions') && allAdditionalOptions.checked)?allAdditionalOptions.click():''">-->
<!--                              <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">-->
<!--                                <input id="item-{{index}}" type="checkbox" [checked]="item$.selected"/> {{item}}-->
<!--                              </ng-template>-->
<!--                              <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">-->
<!--                                <div class="ng-value" *ngFor="let item of items | slice:0:2">-->
<!--                                  <span class="ng-value-icon right" (click)="clear(item)" aria-hidden="true">×</span>-->
<!--                                  <span class="ng-value-label">{{item}}</span>-->
<!--                                </div>-->
<!--                                <div class="ng-value" *ngIf="items.length > 2">-->
<!--                                  <span class="ng-value-label">{{items.length - 2}} more...</span>-->
<!--                                </div>-->
<!--                              </ng-template>-->
<!--                            </ng-select>-->
<!--                          </div>-->

                          <div class="uk-margin-bottom">
                            <div class="uk-margin-small-bottom">
                              <label class="uk-text-bold uk-text-small" for="publicationType">Publication Type</label>
                              <label>
                                <input #allPublicationTypes type="checkbox" class="uk-margin-left uk-margin-small-right" (change)="selectAllData($event, 'publicationTypes')">
                                <span class="uk-text-muted">Select all</span>
                              </label>
                            </div>
                            <ng-select #publicationType labelForId="publicationType" [items]="publicationTypes"
                                       [selectOnTab]="true" [searchable]="false" [multiple]="true"
                                       [closeOnSelect]="false" formControlName="publicationTypes">
                              <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
                                <input id="item-{{index}}" type="checkbox" [checked]="item$.selected"/> {{item}}
                              </ng-template>
                              <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
                                <div class="ng-value" *ngFor="let item of items | slice:0:2">
                                  <span class="ng-value-icon right" (click)="clear(item)" aria-hidden="true">×</span>
                                  <span class="ng-value-label">{{item}}</span>
                                </div>
                                <div class="ng-value" *ngIf="items.length > 2">
                                  <span class="ng-value-label">{{items.length - 2}} more...</span>
                                </div>
                              </ng-template>
                            </ng-select>
                          </div>

                        </div>
                      </form>
                      <!--                  <a href="#" uk-switcher-item="previous" class="uk-margin-small-right">Previous</a>-->
                      <div class="uk-text-center uk-margin-top uk-margin-large-bottom">
                        <a class="uk-button uk-button-primary uk-width-1-1" (click)="continue(3)"
                           [ngClass]="{'uk-disabled': !(stepComplete(2) && stepComplete(1))}">Continue
                        </a>
                      </div>
                    </li>
                    <li>
                      <div class="uk-text-center uk-margin-medium-bottom">
                        <div class="uk-text-bold uk-margin-small-bottom uk-text-large">Indicators</div>
                        <div class="uk-text-light">Pick the indicators to show in your dashboard</div>
                      </div>
                      <div class="uk-margin-medium-bottom">
                        <div class="uk-margin-small-bottom">
                          <label class="uk-text-bold uk-text-small">Indicators *</label>
                          <label>
                            <input #allIndicators type="checkbox" class="uk-margin-left uk-margin-small-right" (change)="selectAllIndicators($event)">
                            <span class="uk-text-muted">Select all</span>
                          </label>
                        </div>

                        <div class="checkbox-list">
                          <div class="uk-padding-small">
                            <div class="uk-margin-small-bottom" *ngFor="let indicator of indicators; let i=index">
                              <div *ngIf="indicators[i-1]?.ui_group !== indicator.ui_group" class="uk-width-1-1">
                                <span class="uk-text-muted">{{indicator.ui_group}}</span>
                              </div>
                              <div class="uk-flex uk-flex-top">
                                <input [id]="indicator.id" type="checkbox" [value]="indicator.id" class="uk-margin-small-right"
                                       (change)="indicatorSelect($event); (removeCheck('indicators') && allIndicators.checked)?allIndicators.click():''"
                                       [checked]="showChecked('indicators', indicator.id)">
                                <label [for]="indicator.id">{{indicator.ui_label}}</label>
                              </div>
                            </div>
                          </div>
                        </div>

                      </div>
                      <div class="uk-text-center uk-margin-top uk-margin-large-bottom">
                        <a class="uk-button uk-button-primary uk-width-1-1" (click)="continue(4)"
                           [ngClass]="{'uk-disabled': !stepComplete(3)}">Continue</a>
                      </div>
                    </li>
                    <li>
                      <div *ngIf="message" class="uk-alert-danger" uk-alert>
                        <a class="uk-alert-close" (click)="clearMessage()" uk-close></a>
                        <p>{{message}}</p>
                      </div>
                      <div class="uk-text-center uk-margin-medium-bottom">
                        <div class="uk-text-bold uk-margin-small-bottom uk-text-large">Summary</div>
                        <div class="uk-text-light">View a summary of your selections before you proceed</div>
                      </div>
                      <div class="uk-margin-medium-bottom summarySection">

                        <table>
                          <tr>
                            <th>Datasource</th>
                            <td>{{bibliometricForm.get('dataSource').value}}</td>
                          </tr>
                          <tr>
                            <th>Subject</th>
                            <td>{{bibliometricForm.get('domain').value}}</td>
                          </tr>
                          <tr>
                            <th>Sector</th>
                            <td>{{bibliometricForm.get('category').value}}</td>
                          </tr>
                          <tr>
                            <th>Technological groups</th>
                            <td><div *ngFor="let topic of bibliometricForm.get('topics').value">{{topic}}</div></td>
                          </tr>
                          <tr>
                            <th>Year from</th>
                            <td>{{bibliometricForm.get('from').value}}</td>
                          </tr>
                          <tr>
                            <th>Year to</th>
                            <td>{{bibliometricForm.get('to').value}}</td>
                          </tr>
                          <tr>
                            <th>Countries of Organizations in Affiliations</th>
                            <td>
                              <span *ngFor="let country of bibliometricForm.get('countries').value; let i=index">{{(i == 0 ? '' : ', ') + country }}</span>
                            </td>
                          </tr>
                          <tr>
                            <th>Access rights</th>
                            <td><div *ngFor="let right of bibliometricForm.get('accessRights').value">{{right}}</div></td>
                          </tr>
<!--                          <tr>-->
<!--                            <th>Additional options</th>-->
<!--                            <td><div *ngFor="let topic of bibliometricForm.get('additionalOptions').value">{{topic}}</div></td>-->
<!--                          </tr>-->
                          <tr>
                            <th>Publication type</th>
                            <td>{{bibliometricForm.get('publicationTypes').value}}</td>
                          </tr>
                          <tr>
                            <th>Indicators</th>
                            <td>
                              <span *ngFor="let indicator of bibliometricForm.get('indicators').value; let i=index">{{(i === 0 ?'':', ') + indicator}}</span>
                            </td>
                          </tr>
                        </table>

                      </div>
                      <div class="uk-text-center uk-margin-top uk-margin-large-bottom">
                        <button type="button" class="uk-button uk-button-primary uk-width-1-1" (click)="submitJob()">Submit</button>
                      </div>
                    </li>
                  </ul>
<!--                  <pre>{{bibliometricForm.getRawValue() | json}}</pre>-->
                </div>
              </div>

            </div>
          </div>
        </div>
      </div>

      <div class="uk-container uk-container-expand" [ngClass]="{'uk-display-none': !submitSuccess}">
        <app-success-page></app-success-page>
      </div>
    </div>
  </div>
</div>
